#!/bin/bash

token="YOUR_ACCESS_TOKEN"
input="1"     # file with project keys (one per line)
output="project_admin_groups.csv"

# CSV header
echo "ProjectName,ProjectKey,GroupName,Role" > "$output"

cat "$input" | while read -r project; do
  echo "Fetching project: $project"

  # --- Get project details ---
  project_resp=$(curl -s -H "Authorization: Bearer $token" \
    "https://your-jfrog-url/access/api/v1/projects/$project")

  proj_key=$(echo "$project_resp"  | grep '"project_key"'  | awk -F '"' '{print $4}')
  proj_name=$(echo "$project_resp" | grep '"display_name"' | awk -F '"' '{print $4}')

  # --- Get groups ---
  groups_resp=$(curl -s -H "Authorization: Bearer $token" \
    "https://your-jfrog-url/access/api/v1/projects/$project/groups")

  names=($(echo "$groups_resp" | grep '"group_name"' | awk -F '"' '{print $4}'))
  roles=($(echo "$groups_resp" | grep '"roles"'      | awk -F '"' '{print $4}'))

  for i in "${!roles[@]}"; do
    if [ "${roles[$i]}" = "Project Admin" ]; then
      echo "$proj_name,$proj_key,${names[$i]},${roles[$i]}" >> "$output"
    fi
  done

done

echo "âœ… Report saved to $output"
