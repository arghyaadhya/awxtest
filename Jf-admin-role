#!/bin/bash

token="YOUR_ACCESS_TOKEN"
input="1"    # file with project keys
output="project_members.csv"

# CSV header
echo "ProjectKey,MemberName,Roles" > "$output"

cat "$input" | while read -r project; do
  echo "Fetching project: $project"

  response=$(curl -s -H "Authorization: Bearer $token" \
       "https://your-jfrog-url/access/api/v1/projects/$project/members")

  # Extract all names and roles (line by line)
  names=$(echo "$response" | grep '"name"'  | awk -F '"' '{print $4}')
  roles=$(echo "$response" | grep '"roles"' | awk -F '"' '{print $4}')

  # Combine into CSV
  paste -d',' <(echo "$project") <(echo "$names") <(echo "$roles") >> "$output"

done

echo "âœ… Report saved to $output"
