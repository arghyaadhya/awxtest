#!/bin/bash

token="YOUR_ACCESS_TOKEN"
input="1"
output="project_admins.csv"

echo "ProjectKey,MemberName,Role" > "$output"

cat "$input" | while read -r project; do
  echo "Fetching project: $project"

  response=$(curl -s -H "Authorization: Bearer $token" \
       "https://your-jfrog-url/access/api/v1/projects/$project/members")

  names=($(echo "$response" | grep '"name"'  | awk -F '"' '{print $4}'))
  roles=($(echo "$response" | grep '"roles"' | awk -F '"' '{print $4}'))

  found=0
  for i in "${!roles[@]}"; do
    if [ "${roles[$i]}" = "Project Admin" ]; then
      echo "$project,${names[$i]},${roles[$i]}" >> "$output"
      found=1
    fi
  done

  if [ $found -eq 0 ]; then
    echo "$project,NoGroup,NoRole" >> "$output"
  fi

done

echo "âœ… Report saved to $output"
