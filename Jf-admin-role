#!/bin/bash

token="YOUR_ACCESS_TOKEN"
input="1"   # file containing project keys (one per line)
output="project_members.csv"

# Write CSV header
echo "ProjectKey,MemberType,MemberName,Roles" > "$output"

# Loop through each project
cat "$input" | while read -r project; do
  echo "Fetching members for project: $project"

  response=$(curl -s -H "Authorization: Bearer $token" \
       "https://your-jfrog-url/access/api/v1/projects/$project/members")

  # Parse JSON safely â†’ project, type, name, roles
  echo "$response" | jq -r --arg project "$project" '
    .members[]? | [$project, .principal_type, .name, (.roles | join(";"))] | @csv
  ' >> "$output"

done

echo "Report generated: $output"
