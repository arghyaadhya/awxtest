#!/bin/bash

# Input and Output Files
input_file="input.txt"
output_file="output.txt"

# Hostname to match
hostname="your_hostname"

# Temporary Variables
in_block=false         # Whether we're inside a block
block_start=false      # Start of the block
block_content=()       # Array to hold lines of the block
block_only_hostname=true

# Function to process the block
process_block() {
    block_only_hostname=true
    for line in "${block_content[@]}"; do
        if [[ $line != "$hostname" && -n $line ]]; then
            block_only_hostname=false
        fi
    done

    # If block contains only the hostname, skip it
    if $block_only_hostname; then
        return
    fi

    # If the block has other content, exclude the hostname line
    for line in "${block_content[@]}"; do
        if [[ $line != "$hostname" ]]; then
            echo "$line"
        fi
    done
}

# Read input line by line
while IFS= read -r line || [[ -n $line ]]; do
    if [[ $line == "Begin limit" ]]; then
        in_block=true
        block_start=true
        block_content=()
    elif [[ $line == "End limit" ]]; then
        in_block=false
        block_content+=("$line")
        process_block
    elif $in_block; then
        block_content+=("$line")
    else
        echo "$line"
    fi
done < "$input_file" > "$output_file"

echo "Processed file saved to $output_file."
